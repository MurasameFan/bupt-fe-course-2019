{"version":3,"sources":["Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/Script/view","sourcesContent":["const { ccclass, property } = cc._decorator;\n\nimport { BgMoveAction } from './BgMove';\nimport { level } from './BgMove';\nimport { GameAction } from '../controller/Game';\n\nexport type PlayerAction = {\n    birth: () => void;\n};\n\n@ccclass\nexport default class Player extends cc.Component {\n    GameComponent: GameAction;\n    bgComponent: BgMoveAction;\n\n    @property(cc.Node)\n    game: cc.Node = null;\n\n    // @property(cc.Boolean)\n    // dead: boolean = false;\n\n    // 跑步状态\n    @property(cc.Boolean)\n    running: boolean = false;\n\n    // 跳跃相关\n    @property(cc.Integer)\n    jumpLevel: number = 0; // 允许二段跳 max 2\n\n    // 跳跃状态\n    @property(cc.Boolean)\n    jumping: boolean = false;\n\n    // 允许几段跳 max - 1\n    @property(cc.Integer)\n    jumpMax = 3;\n\n    // 跳跃的初始化速度\n    @property(cc.Integer)\n    jumpSpeed: number = 0;\n\n    // 定义地面\n    @property()\n    groundY: number = 0;\n\n    // 速度\n    @property(cc.Vec2)\n    speed: cc.Vec2 = cc.v2(200, 0);\n\n    // 最大速度\n    @property(cc.Vec2)\n    maxSpeed: cc.Vec2 = cc.v2(400, 2000);\n\n    // 横向加速度\n    @property()\n    accel: number = 100;\n\n    // 重力\n    @property()\n    gravity: number = -3000;\n\n    @property(cc.Node)\n    bg: cc.Node = null;\n\n    // 碰撞相关\n    @property(cc.Integer)\n    collisionX: number = 0;\n\n    @property(cc.Integer)\n    collisionY: number = 0;\n\n    // 销毁时\n    onDestroy() {\n        cc.systemEvent.off(\n            cc.SystemEvent.EventType.KEY_DOWN,\n            this.onKeyDown,\n            this,\n        );\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    onKeyDown(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                // 按下播放跑动动画\n                this.getComponent(cc.Animation).play('player_run');\n                this.running = true;\n                break;\n        }\n    }\n\n    onKeyUp(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.d:\n            case cc.macro.KEY.right:\n                // 拿起停止动画\n                this.getComponent(cc.Animation).stop('player_run');\n                this.running = false;\n                this.speed.x = 200;\n                break;\n            case cc.macro.KEY.w:\n            case cc.macro.KEY.up:\n                if (this.jumpLevel < this.jumpMax - 1) {\n                    this.jumping = true;\n                    this.speed.y = this.jumpSpeed;\n                    ++this.jumpLevel;\n                }\n                break;\n        }\n    }\n\n    // 移动函数\n    move = (dt: number) => {\n        if (this.running && this.collisionX === 0) {\n            // 正向移动判断\n            if (this.speed.x < this.maxSpeed.x) {\n                // 速度逐渐加快\n                this.speed.x += this.accel * dt;\n            }\n            // 先跑到屏幕中间\n            if (this.node.x < this.node.parent.width / 2) {\n                this.node.x += this.speed.x * dt;\n            } else {\n                this.bgComponent.bgMove(this.speed.x * dt); // x移动是通过背景移动进行\n            }\n        }\n\n        if (this.jumping && this.jumpLevel < this.jumpMax) {\n            // 检测跳跃\n            this.speed.y += this.gravity * dt;\n            if (Math.abs(this.speed.y) > this.maxSpeed.y) {\n                // 限制最大跳跃速度\n                this.speed.y =\n                    this.speed.y > 0 ? this.maxSpeed.y : -this.maxSpeed.y;\n            }\n\n            this.node.y += this.speed.y * dt;\n        }\n        // 平面检测\n        if (this.node.y <= this.groundY) {\n            this.node.y = this.groundY;\n            this.jumpLevel = 0;\n            this.jumping = false;\n        }\n    };\n\n    init() {\n        this.birth();\n        this.GameComponent = this.game.getComponent('Game');\n        this.groundY = this.node.y; // 设置地板位置\n        this.bgComponent = this.bg.getComponent('BgMove'); // 获取背景\n        // 碰撞检测\n        this.collisionX = 0; //x轴是否碰撞，0：没有碰撞，-1：左方有碰撞，1：右方有碰撞\n        this.collisionY = 0;\n    }\n\n    dead() {\n        this.node.x = -999; // 移出屏幕\n        this.getComponent(cc.Animation).stop('player_run');\n        this.running = false;\n        this.speed.x = 200;\n        cc.systemEvent.off(\n            cc.SystemEvent.EventType.KEY_DOWN,\n            this.onKeyDown,\n            this,\n        );\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    public birth() {\n        this.node.x = 200;\n        this.node.y = 104;\n        // 设置键盘监听\n        cc.systemEvent.on(\n            cc.SystemEvent.EventType.KEY_DOWN,\n            this.onKeyDown,\n            this,\n        );\n\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    onCollisionEnter(other, self) {\n        if (other.node.group === 'blank') {\n            // 遇见空白时 直接返回 并且是跳跃状态\n            if (!this.jumping) {\n                this.jumping = true;\n            }\n            return;\n        }\n\n        if (other.node.group === 'stone') {\n            // 遇见石头 结束游戏\n            this.dead();\n            this.GameComponent.overGame();\n            return;\n        }\n\n        // 碰撞进入\n        const otherAabb = other.world.aabb;\n        const otherPreAabb = other.world.preAabb.clone(); // 上一帧碰撞框\n\n        const selfAabb = self.world.aabb;\n        const selfPreAabb = self.world.preAabb.clone();\n\n        // 我们需要退回上一步的状态 先判断x的碰撞\n        selfPreAabb.x = selfAabb.x;\n        otherPreAabb.x = otherAabb.x;\n\n        if (cc.Intersection.rectRect(selfPreAabb, otherPreAabb)) {\n            // 检查x碰撞\n            if (this.speed.x > 0) {\n                this.node.x = otherPreAabb.xMin - selfPreAabb.width / 2 - 1;\n            }\n            this.collisionX = 1;\n            other.touchingX = true;\n            return;\n        }\n\n        selfPreAabb.y = selfAabb.y;\n        otherPreAabb.y = otherAabb.y;\n\n        if (cc.Intersection.rectRect(selfAabb, otherAabb)) {\n            if (this.speed.y < 0 && selfPreAabb.yMax > otherPreAabb.yMax) {\n                this.node.y = otherPreAabb.yMax;\n                this.jumpLevel = 0;\n                this.collisionY = -1;\n                Object.keys(level).forEach(item => {\n                    // 到达平台 不做掉落判断\n                    if (level[item] + other.node.height / 2 === this.node.y) {\n                        this.jumping = false;\n                    }\n                });\n            } else if (\n                this.speed.y > 0 &&\n                selfPreAabb.yMin < otherPreAabb.yMin\n            ) {\n                this.node.y =\n                    otherPreAabb.yMin -\n                    selfPreAabb.height -\n                    other.node.height / 2;\n                this.collisionY = 1;\n            }\n\n            this.speed.y = 0;\n            other.touchingY = true;\n        }\n    }\n\n    onCollisionExit(other, self) {\n        if (other.touchingX) {\n            this.collisionX = 0;\n            other.touchingX = false;\n        } else if (other.touchingY) {\n            other.touchingY = false;\n            this.collisionY = 0;\n        }\n    }\n\n    onLoad() {\n        this.init();\n    }\n\n    update(dt: number) {\n        // 角色移动\n        this.move(dt);\n    }\n}\n"]}